# üîê Forgot Password Setup Guide - Supabase Configuration

## üìä Current Status

### ‚úÖ Code Implementation
- **ForgotPasswordForm**: Fully implemented with Turnstile security
- **ResetPasswordForm**: Complete with validation & session check
- **Routing**: Properly configured in main.tsx
- **API Integration**: Using correct Supabase Auth methods

### üîç Database Check
**Test Users Available:**
- member1@gmail.com ‚úÖ (email confirmed)
- member2@gmail.com ‚úÖ (email confirmed)
- admin1@gmail.com ‚úÖ (email confirmed)
- admin2@gmail.com ‚úÖ (email confirmed)

### üåê Supabase Project
- **Project URL**: https://gpittnsfzgkdbqnccncn.supabase.co
- **Project Ref**: gpittnsfzgkdbqnccncn

---

## üõ†Ô∏è Required Supabase Configuration

### Step 1: Configure Site URL & Redirect URLs

**Go to:** Supabase Dashboard ‚Üí Authentication ‚Üí URL Configuration

#### Development Settings:
```
Site URL: http://localhost:5173
```

#### Redirect URLs (Add these):
```
http://localhost:5173/reset-password
http://localhost:5173/**
```

#### Production Settings (when deploying):
```
Site URL: https://yourdomain.com
Redirect URLs:
  - https://yourdomain.com/reset-password
  - https://yourdomain.com/**
```

### Step 2: Configure Email Templates

**Go to:** Supabase Dashboard ‚Üí Authentication ‚Üí Email Templates

#### Reset Password Template

**Subject:**
```
Reset Your Password
```

**Body (HTML):**
```html
<h2>Reset Your Password</h2>
<p>Hi there,</p>
<p>Someone requested a password reset for your account. If this was you, click the button below to reset your password:</p>
<p><a href="{{ .SiteURL }}/reset-password?token={{ .Token }}&type=recovery" style="display: inline-block; padding: 12px 24px; background-color: #5271ff; color: white; text-decoration: none; border-radius: 8px;">Reset Password</a></p>
<p>Or copy and paste this link into your browser:</p>
<p>{{ .SiteURL }}/reset-password?token={{ .Token }}&type=recovery</p>
<p>If you didn't request this, you can safely ignore this email.</p>
<p>This link will expire in 1 hour.</p>
<p>Thanks,<br>Canvango Group Team</p>
```

**Important Variables:**
- `{{ .SiteURL }}` - Your site URL (configured in Step 1)
- `{{ .Token }}` - Reset token (auto-generated by Supabase)
- `{{ .Email }}` - User's email address

### Step 3: Email Provider Settings

**Go to:** Supabase Dashboard ‚Üí Project Settings ‚Üí Auth

#### For Development (Default):
- Supabase uses built-in email service
- **Limitation**: Max 4 emails per hour per project
- Emails might go to spam folder

#### For Production (Recommended):
Configure custom SMTP:

**SMTP Settings:**
```
SMTP Host: smtp.gmail.com (or your provider)
SMTP Port: 587
SMTP User: your-email@gmail.com
SMTP Password: your-app-password
Sender Email: noreply@yourdomain.com
Sender Name: Canvango Group
```

**Popular SMTP Providers:**
- Gmail (with App Password)
- SendGrid
- AWS SES
- Mailgun
- Postmark

### Step 4: Rate Limiting Configuration

**Go to:** Supabase Dashboard ‚Üí Authentication ‚Üí Rate Limits

**Recommended Settings:**
```
Password Reset Requests: 5 per hour per email
Email Confirmation: 5 per hour per email
```

---

## üß™ Testing Guide

### Test Scenario 1: Request Password Reset

1. **Open browser:**
   ```
   http://localhost:5173/forgot-password
   ```

2. **Enter test email:**
   ```
   member1@gmail.com
   ```

3. **Complete Turnstile verification** (if enabled)

4. **Click "Kirim Link Reset"**

5. **Expected Result:**
   - Success message: "Link reset password telah dikirim ke email Anda"
   - UI shows confirmation screen

### Test Scenario 2: Check Email

1. **Check inbox** for email from Supabase
   - Subject: "Reset Your Password"
   - From: noreply@mail.app.supabase.io (default) or your custom sender

2. **If email not received:**
   - Check spam/junk folder
   - Wait 1-2 minutes (email delivery delay)
   - Check Supabase logs (see below)

### Test Scenario 3: Reset Password

1. **Click link in email** ‚Üí redirects to:
   ```
   http://localhost:5173/reset-password?token=xxx&type=recovery
   ```

2. **Enter new password:**
   - Minimum 8 characters
   - At least 1 uppercase letter
   - At least 1 lowercase letter
   - At least 1 number

3. **Confirm password** (must match)

4. **Click "Reset Password"**

5. **Expected Result:**
   - Success message: "Password berhasil diperbarui"
   - Auto redirect to login page after 2 seconds

### Test Scenario 4: Login with New Password

1. **Go to login page:**
   ```
   http://localhost:5173/login
   ```

2. **Login with:**
   - Email: member1@gmail.com
   - Password: [your new password]

3. **Expected Result:**
   - Successfully logged in
   - Redirected to dashboard

---

## üîç Debugging & Troubleshooting

### Check Supabase Auth Logs

**Via MCP Tool:**
```typescript
// Check auth logs for reset password activity
mcp_supabase_get_logs({ service: 'auth' })
```

**Look for:**
- `"msg": "Sent recovery email"` - Email sent successfully
- `"error": "..."` - Any errors during process

### Common Issues & Solutions

#### Issue 1: Email Not Received
**Possible Causes:**
- Site URL not configured correctly
- Email in spam folder
- Rate limit exceeded
- SMTP not configured (production)

**Solution:**
1. Check Site URL matches your environment
2. Check spam folder
3. Wait and try again (rate limit)
4. Configure custom SMTP for production

#### Issue 2: Reset Link Invalid/Expired
**Possible Causes:**
- Link expired (default: 1 hour)
- Link already used
- Token invalid

**Solution:**
1. Request new reset link
2. Use link within 1 hour
3. Don't click link multiple times

#### Issue 3: Password Validation Failed
**Possible Causes:**
- Password too short (< 8 characters)
- Missing uppercase/lowercase/number
- Passwords don't match

**Solution:**
1. Follow password requirements:
   - Min 8 characters
   - 1 uppercase (A-Z)
   - 1 lowercase (a-z)
   - 1 number (0-9)

#### Issue 4: Turnstile Verification Failed
**Possible Causes:**
- Invalid Turnstile token
- Network error
- Token expired

**Solution:**
1. Refresh page and try again
2. Check Turnstile configuration
3. Disable Turnstile temporarily for testing

---

## üìù Configuration Checklist

Before testing, ensure:

- [ ] Site URL configured in Supabase Dashboard
- [ ] Redirect URLs added (including /reset-password)
- [ ] Email template configured with correct variables
- [ ] SMTP configured (for production)
- [ ] Rate limits set appropriately
- [ ] Test user email confirmed
- [ ] Turnstile keys configured (if using)

---

## üöÄ Quick Start Commands

### Test Forgot Password Flow:
```bash
# 1. Start dev server
npm run dev

# 2. Open forgot password page
# http://localhost:5173/forgot-password

# 3. Use test email: member1@gmail.com
```

### Check Auth Logs:
```bash
# Via Supabase Dashboard
# Go to: Logs ‚Üí Auth Logs
# Filter: "recovery" or "reset"
```

---

## üìû Support

If issues persist after following this guide:

1. **Check Supabase Status**: https://status.supabase.com
2. **Review Auth Logs**: Supabase Dashboard ‚Üí Logs ‚Üí Auth
3. **Test with Different Email**: Try another confirmed user
4. **Disable Turnstile**: Test without security verification first

---

## üéØ Next Steps

After configuration:

1. ‚úÖ Test forgot password flow end-to-end
2. ‚úÖ Verify email delivery
3. ‚úÖ Test password reset
4. ‚úÖ Confirm login with new password
5. ‚úÖ Configure production SMTP (when deploying)
6. ‚úÖ Update email templates with branding
7. ‚úÖ Set appropriate rate limits

---

**Last Updated**: November 27, 2025
**Status**: Ready for Configuration & Testing
